{% extends "layout.html" %}

{% block content%}
<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" />
<div class="container">
    <div class="row">
        <div class="col-md-12">
            <div class="d-flex justify-content-evenly">
                <div style="width: 665px;">
                    <div class="d-flex justify-content-center" style="padding: 15px;">
                        <!-- <form action=""> -->
                        <img src="{% url 'video' %}">
                        <!-- </form> -->
                    </div>
                </div>
                <div>
                    <div>
                        <div data-bs-spy="scroll" data-bs-target="#list-example" data-bs-smooth-scroll="true"
                            class="scrollspy-example" tabindex="0">
                            <div class="col-lg-12">
                                <div class="main-box no-header clearfix">
                                    <div class="main-box-body clearfix">
                                        <div class="table-responsive"
                                            style="width:100%;overflow:auto; max-height:470px;">
                                            <!-- <table class="table user-list">
                                                <thead class="sticky-top bg-white">
                                                    <tr>
                                                        <th><span>User</span></th>
                                                        <th><span>Available DA</span></th>
                                                        <th><span>Absent DA</span></th>
                                                    </tr>
                                                </thead>
                                                <tbody id="dataBody">
                                                    <tr>
                                                        <td style="color: rgb(32, 32, 218);font-size: 17px;">
                                                            Abdusattor Yaminjonov
                                                        </td>
                                                        <td style="font-size: 15px;">19/04/2024 09:00 </td>
                                                        <td style="font-size: 15px;">19/04/2024 14:50 </td>
                                                    </tr>
                                                </tbody>
                                            </table> -->
                                            <table id="dataBody"  class="table" border="1">
                                            </table>

                                            <script>
                                                // Define the path to the text file
                                                const filePath = 'http://127.0.0.1:8000/static/userlist.txt';
                                                // Function to fetch and update data
                                                function fetchDataAndUpdateTable() {
                                                    fetch(filePath)
                                                        .then(response => {
                                                            if (!response.ok) {
                                                                throw new Error('Failed to fetch data');
                                                            }
                                                            return response.text();
                                                        })
                                                        .then(data => {
                                                            // Split the data into rows using line breaks
                                                            const rows = data.trim().split('\n');

                                                            // Get a reference to the table body
                                                            const tbody = document.getElementById('dataBody');

                                                            // Clear existing rows
                                                            tbody.innerHTML = '';

                                                            // Loop through the rows and create table rows
                                                            rows.forEach(row => {
                                                                // Split each row into columns using comma as delimiter
                                                                const columns = row.split(', ');

                                                                // Create a table row
                                                                const tr = document.createElement('tr');

                                                                // Loop through the columns and create table cells
                                                                columns.forEach(column => {
                                                                    // Split each column using a different delimiter
                                                                    const parts = column.split('/');

                                                                    // Create a table cell
                                                                    const td = document.createElement('td');
                                                                    // Join the parts back together with a space delimiter
                                                                    td.textContent = parts.join(' ');
                                                                    // Append the cell to the row
                                                                    tr.appendChild(td);
                                                                });

                                                                // Append the row to the table body
                                                                tbody.appendChild(tr);
                                                            });
                                                        })
                                                        .catch(error => {
                                                            console.error('Error:', error);
                                                        });
                                                }

                                                // Call the function initially
                                                fetchDataAndUpdateTable();

                                                // Set interval to fetch and update data every 5 seconds (for example)
                                                setInterval(fetchDataAndUpdateTable, 5000); // 5000 milliseconds = 5 seconds

                                            </script>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Define the path to the text file
    const filePath = 'file:///C:/Users/asus/OneDrive/Desktop/pbl4/davomat/face_detection/userlist.txt';

    // Function to fetch and update data
    function fetchDataAndUpdateTable() {
        fetch(filePath)
            .then(response => {
                if (!response.ok) {
                    throw new Error('Failed to fetch data');
                }
                return response.text();
            })
            .then(data => {
                // Split the data into rows using line breaks
                const rows = data.trim().split('\n');

                // Get a reference to the table body
                const tbody = document.getElementById('dataBody');

                // Clear existing rows
                tbody.innerHTML = '';

                // Loop through the rows and create table rows
                rows.forEach(row => {
                    // Split each row into columns using comma as delimiter
                    const columns = row.split(', ');

                    // Create a table row
                    const tr = document.createElement('tr');

                    // Loop through the columns and create table cells
                    columns.forEach(column => {
                        // Split each column using a different delimiter
                        const parts = column.split('/');

                        // Create a table cell
                        const td = document.createElement('td');
                        // Join the parts back together with a space delimiter
                        td.textContent = parts.join(' ');
                        // Append the cell to the row
                        tr.appendChild(td);
                    });

                    // Append the row to the table body
                    tbody.appendChild(tr);
                });
            })
            .catch(error => {
                console.error('Error:', error);
            });
    }

    // Call the function initially
    fetchDataAndUpdateTable();

    // Set interval to fetch and update data every 5 seconds (for example)
    setInterval(fetchDataAndUpdateTable, 5000); // 5000 milliseconds = 5 seconds
</script>

{% endblock content%}